<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Customer Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('serve_root_styles') }}">
</head>
<body>
    <header class="site-header">
        <div class="header-container">
            <a href="{{ url_for('home') }}" class="logo">
                <svg class="logo-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path fill="currentColor" d="M7 4h-2a1 1 0 0 0 0 2h1.22l1.6 6.4a2 2 0 0 0 1.95 1.45h7.48a1 1 0 0 0 .97-.76l1.2-5.2a1 1 0 0 0-.97-1.24H8.7L8.2 4.2A1 1 0 0 0 7 4zm0 14a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm10 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3z"/>
                </svg>
                <span class="logo-text">GrocerEase</span>
            </a>
            <nav class="nav-buttons">
                <a href="{{ url_for('customer_dashboard') }}" class="nav-btn nav-btn--primary">My Account</a>
                <a href="{{ url_for('logout') }}" class="nav-btn nav-btn--secondary">Logout</a>
            </nav>
        </div>
    </header>

    <main>
        <section class="page-hero">
            <div class="hero-content">
                <div class="hero-copy">
                    <h1>Welcome back, {{ user_name }}!</h1>
                    <p class="lead">Fresh produce added today. Check recommended items based on your past orders.</p>
                </div>
                <div class="hero-illustration" aria-hidden="true">
                    <svg viewBox="0 0 120 90" xmlns="http://www.w3.org/2000/svg" role="img">
                        <rect x="10" y="18" width="70" height="40" rx="6" fill="#3b82f6" />
                        <line x1="80" y1="22" x2="100" y2="8" stroke="#2563eb" stroke-width="6" stroke-linecap="round" />
                        <circle cx="38" cy="70" r="8" fill="#0ea5a4" />
                        <circle cx="78" cy="70" r="8" fill="#0ea5a4" />
                    </svg>
                </div>
            </div>
        </section>

        <h2>Customer Portal</h2>
        <p>Welcome, {{ user_name }}. From here you can submit grocery items, view products and check order status.</p>

        <section>
            <h2>Submit grocery items</h2>
            <form action="{{ url_for('submit_order') }}" method="post">
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 1rem;">
                    <thead>
                        <tr style="border-bottom: 2px solid var(--border);">
                            <th style="padding: 0.5rem; text-align: left;">Select</th>
                            <th style="padding: 0.5rem; text-align: left;">Product</th>
                            <th style="padding: 0.5rem; text-align: center;">Quantity</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for p in products %}
                        <tr style="border-bottom: 1px solid var(--border);">
                            <td style="padding: 0.5rem;">
                                <input type="checkbox" name="product_ids" value="{{ p['product_id'] }}" id="prod_{{ p['product_id'] }}">
                            </td>
                            <td style="padding: 0.5rem;">
                                <label for="prod_{{ p['product_id'] }}">{{ p['product_name'] }}</label>
                            </td>
                            <td style="padding: 0.5rem; text-align: center;">
                                <input type="number" name="qty_{{ p['product_id'] }}" min="1" value="1" style="width: 100px; text-align: center; font-size: 16px;">
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <div style="margin: 0.5rem 0">
                    <label for="current-location">Pickup Location</label>
                    <select id="current-location" name="current-location" required style="width: 100%; padding: 0.5rem; margin-top: 0.25rem;">
                        <option value="">-- Select a pickup location --</option>
                        {% for loc in locations %}
                            <option value="{{ loc['location_id'] }}">{{ loc['loacation_name'] }}</option>
                        {% endfor %}
                    </select>
                </div>

                <p><button type="submit">Submit Order</button></p>
            </form>
        </section>

        <section>
            <h2>Your Orders</h2>

            {% if orders %}
                <ul class="order-list">
                    {% for order in orders %}
                        <li class="order-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border: 1px solid var(--border); border-radius: var(--radius-sm); margin-bottom: 0.5rem;">
                            <div>
                                <strong>Order #{{ order['order_id'] }}</strong><br>
                                Items: {{ order['grc_items'] }}<br>
                                Location: {{ order['loacation_name'] }}
                            </div>
                            <form action="{{ url_for('delete_order', order_id=order['order_id']) }}" method="post">
                                <button type="submit" class="btn btn--danger" style="padding: 0.4rem 0.8rem; font-size: 0.85rem;" onclick="return confirm('Are you sure you want to delete this order? This action cannot be undone.')">Delete</button>
                            </form>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>You don't have any orders yet. Submit your first grocery list above.</p>
            {% endif %}
        </section>

    </main>

    <div class="back-to-home">
        <a class="btn btn--danger" href="{{ url_for('home') }}">Back to Home</a>
    </div>
</body>
</html>
